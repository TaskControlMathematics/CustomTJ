(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{1456:function(t,s,e){"use strict";e(992)},1457:function(t,s,e){(s=e(30)(!1)).push([t.i,".v-etc-controls-container .popover {\n  position: absolute;\n  top: var(--top, 0);\n  left: var(--left, 0);\n  z-index: 17;\n}\n.v-etc-controls-container .popover--fixed {\n  z-index: 21;\n}\n",""]),t.exports=s},1656:function(t,s,e){"use strict";e.r(s),e.d(s,"Link",(function(){return E})),e.d(s,"Toggle",(function(){return b})),e.d(s,"Button",(function(){return w})),e.d(s,"AjaxToggle",(function(){return S})),e.d(s,"AjaxButton",(function(){return k})),e.d(s,"default",(function(){return C}));var i=e(35),a=e.n(i),n=function(){var t=this.$createElement,s=this._self._c||t;return s("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:this.close,expression:"close"}],staticClass:"v-etc-controls-container"},[this.items.length?s("popover",{ref:"popover",class:["popover--"+this.currentAlign,{"popover--fixed":"fixed"===this.position}],style:this.popoverStyle,attrs:{data:this.items,"is-selectable":!1}}):this._e()],1)};n._withStripped=!0;var r={name:"etc-controls-container",components:{Popover:e(89).default},data:()=>({items:[],currentTarget:null,popoverPosition:{top:0,left:0},isPositionReady:!1,position:"absolute",currentAlign:"center"}),computed:{popoverStyle(){const{top:t,left:s}=this.popoverPosition;return{"--top":t+"px","--left":s+"px",visibility:this.isPositionReady?"visible":"hidden"}}},created(){this.$root._etcControlsContainer=this,window.addEventListener("resize",this.close)},beforeDestroy(){window.removeEventListener("resize",this.close)},methods:{open({items:t,target:s,position:e="absolute",align:i="center"}){this.currentTarget=s,this.items=t,this.position=e,this.currentAlign=i,this.$emit("open"),this.updatePopoverPosition()},close(){this.items.length&&(this.items=[],this.$emit("close"))},updatePopoverPosition(){this.isPositionReady=!1;const t=this.currentTarget.getBoundingClientRect(),s=8,e=5;this.popoverPosition.top=window.pageYOffset+t.top+t.height+e,setTimeout(()=>{const{popover:i}=this.$refs;if(!i)return;const{clientWidth:a,clientHeight:n}=document.documentElement,r=i.$el.getBoundingClientRect();"left"===this.currentAlign?this.popoverPosition.left=t.left-s:"right"===this.currentAlign?this.popoverPosition.left=t.right-r.width+s:this.popoverPosition.left=t.left+.5*t.width-.5*r.width,setTimeout(()=>{const s=i.$el.getBoundingClientRect(),r=s.right-a,o=0-s.left,c=s.bottom-n,l=0-s.top;r>0&&(this.popoverPosition.left-=r),o>0&&(this.popoverPosition.left=0),c>0&&(this.popoverPosition.top-=s.height+t.height+2*e),l>0&&(this.popoverPosition.top=0),this.isPositionReady=!0},0)},0)}}},o=(e(1456),e(10)),c=Object(o.a)(r,n,[],!1,null,null,null);c.options.__file="src/Components/Ui/vue/plugins/etc-controls/etc-controls-container.vue";var l=c.exports,h={install(t){const s=document.createElement("div"),e=new t({render:t=>t(l)});document.body.appendChild(s),e.$mount(s),t.prototype.$etcControls={open(t){e._etcControlsContainer.open(t)},close(){e._etcControlsContainer.close()},on(t,s){e._etcControlsContainer.$on(t,s)},once(t,s){e._etcControlsContainer.$once(t,s)},off(t,s){e._etcControlsContainer.$off(t,s)}}}},m=e(123),p=e(44),u=e.n(p),d=e(55),g=e(3),v=e(0),f=e(11);class E{constructor(t,s){this.mainElement=t,this.params=s,void 0===this.params.msg&&(this.params.msg={})}get popoverData(){return{label:this.params.label,analyticsEvent:this.params.analyticsEvent,url:this.params.href||this.params.getHref(this.mainElement)}}destroy(){this.mainElement=null,this.params=null}}var y=e(5);class b{constructor(t,s){this.mainElement=t,this.params=s,void 0===this.params.msg&&(this.params.msg={}),this.setState(this.getState())}get popoverData(){return{label:this.params.labels[this.currentState],analyticsEvent:this.analyticsEvent,action:async t=>{await this.makeAction(),t.label=this.params.labels[this.currentState],t.analyticsEvent=this.analyticsEvent}}}get analyticsEvent(){return Array.isArray(this.params.analyticsEvent)?this.params.analyticsEvent[this.currentState]:this.params.analyticsEvent}getState(){return"1"===Object(v.data)(this.mainElement,this.params.name+"-state")?1:0}setState(t){this.currentState=t,Object(v.data)(this.mainElement,this.params.name+"-state",this.currentState)}makeAction(){return new Promise((t,s)=>{(void 0===this.params.msg.confirm||confirm(this.params.msg.confirm[this.currentState]))&&this.params.action(this.mainElement,this.currentState,s=>{!1!==s&&void 0!==this.params.msg.success?y.success(this.params.msg.success[this.currentState]):!1===s&&void 0!==this.params.msg.error&&y.error(this.params.msg.error[this.currentState]),!1!==s&&(this.setState(1-this.currentState),t()),void 0!==this.params.callback&&this.params.callback()})})}destroy(){this.dom=null,this.params=null}}class w{constructor(t,s){this.mainElement=t,this.params=s,void 0===this.params.msg&&(this.params.msg={})}get popoverData(){return{label:this.params.label,analyticsEvent:this.params.analyticsEvent,action:()=>{if("function"==typeof this.params.getClickData){const t=this.params.getClickData(this.mainElement),s=w.parseAirClickAttribute(t);window.triggerDomEvent.call(this,s.name,s.params)}else this.makeAction()}}}makeAction(){(void 0===this.params.msg.confirm||confirm(this.params.msg.confirm))&&this.params.action(this.mainElement,t=>{!1!==t&&void 0!==this.params.msg.success?y.success(this.params.msg.success):!1===t&&void 0!==this.params.msg.error&&y.error(this.params.msg.error),void 0!==this.params.callback&&this.params.callback(t)})}destroy(){this.mainElement=null,this.params=null}static parseAirClickAttribute(t){const s=t.match(/[^?]*/)[0],e=t.match(/[^?]*$/)[0];return{name:s,params:e?e.split("&").reduce((t,s)=>{const e=s.split("=");return t[e[0]]=e[1],t},{}):{}}}}class S{constructor(t,s){this.mainElement=t,this.params=s,void 0===this.params.msg&&(this.params.msg={}),this.setState(this.getState())}get popoverData(){return{label:this.params.labels[this.currentState],disabled:!1,analyticsEvent:this.analyticsEvent,action:async t=>{t.disabled=!0,await this.sendAjax(),t.disabled=!1,t.label=this.params.labels[this.currentState],t.analyticsEvent=this.analyticsEvent}}}get analyticsEvent(){return Array.isArray(this.params.analyticsEvent)?this.params.analyticsEvent[this.currentState]:this.params.analyticsEvent}getState(){return"1"===Object(v.data)(this.mainElement,this.params.name+"-state")?1:0}setState(t){this.currentState=t,Object(v.data)(this.mainElement,this.params.name+"-state",this.currentState)}sendAjax(){return new Promise((t,s)=>{(void 0===this.params.msg.confirm||confirm(this.params.msg.confirm[this.currentState]))&&g.c({url:void 0!==this.params.urls?this.params.urls[this.currentState]:this.params.url,data:void 0!==this.params.getData?this.params.getData(this.mainElement,this.currentState):{},complete:(s,e)=>{!0!==e&&void 0!==this.params.msg.success?y.success(this.params.msg.success[this.currentState]):!0===e&&void 0!==this.params.msg.error&&y.error(this.params.msg.error[this.currentState]),!0!==e&&(this.setState(1-this.currentState),t()),void 0!==this.params.callback&&this.params.callback(s,e)}})})}destroy(){this.mainElement=null,this.params=null}}class k{constructor(t,s){this.mainElement=t,this.params=s,void 0===this.params.msg&&(this.params.msg={})}get popoverData(){return{label:this.params.label,disabled:!1,analyticsEvent:this.params.analyticsEvent,action:async t=>{t.disabled=!0,await this.sendAjax(),t.disabled=!1}}}sendAjax(){return new Promise((t,s)=>{if(void 0!==this.params.msg.confirm&&!confirm(this.params.msg.confirm))return t();g.c({url:void 0!==this.params.getUrl?this.params.getUrl(this.mainElement):this.params.url,data:void 0!==this.params.getData?this.params.getData(this.mainElement):{},complete:(s,e)=>{!0!==e&&void 0!==this.params.msg.success?y.success(this.params.msg.success):!0===e&&void 0!==this.params.msg.error&&y.error(this.params.msg.error),void 0!==this.params.callback&&this.params.callback(s,e),t()}})})}destroy(){this.mainElement=null,this.params=null}}class C{constructor(t){this.element=t.element,this.controllingModule=t.controlling_module,this.clickHandler=this.onElementClick.bind(this),this.isOpened=!1,this.isLoading=!1,this.config=this.element.dataset,this.permissions={},this.items=[],this.element.addEventListener("click",this.clickHandler),this.init()}init(){this.extendVue(),this.app=new a.a,this.app.$etcControls.on("close",()=>{this.isOpened=!1});const t=window.Air&&window.Air.get("module.hawk");t&&t.connectVue(a.a)}extendVue(){a.a.directive("click-outside",m.a),a.a.use(u.a,{translations:d,defaultLanguage:window.__i18nLocale}),a.a.use(h)}onElementClick(t){const s=Object(v.data)(this.element,"analytics-event-name");s&&f.sendDefaultEvent(s),t.preventDefault(),t.stopPropagation(),this.isOpened?this.close():this.open()}async open(){this.isOpened||this.isLoading||(this.isLoading=!0,this.items.length||(this.permissions=await C.getPermissions(this.config.permissions),Object.entries(this.permissions).forEach(([t,s])=>{if(!s)return;const e=this.controllingModule.getControl(this.element,t);e&&e.popoverData&&this.items.push({...e.popoverData,action:t=>{"function"==typeof e.popoverData.action&&e.popoverData.action(t),this.app.$etcControls.close()}})})),this.isLoading=!1,this.items.length&&(this.isOpened=!0,this.app.$etcControls.open({items:this.items,target:this.element,position:this.config.position,align:this.config.align})))}close(){this.isOpened=!1,this.app.$etcControls.close()}destroy(){this.close(),this.element.removeEventListener("click",this.clickHandler),this.clickHandler=null,this.config={},this.permissions={},this.app.$etcControls&&this.app.$etcControls.off("close"),this.app&&(this.app.$destroy(),this.app=null)}static getPermissions(t){return Object(g.e)({type:"get",url:"/etc/permissions",data:{token:t}})}}},992:function(t,s,e){var i=e(1457);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,e(31).default)("42580c82",i,!1,{})}}]);