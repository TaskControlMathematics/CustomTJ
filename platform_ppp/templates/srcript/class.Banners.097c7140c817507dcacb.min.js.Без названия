(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{527:function(t,i,e){"use strict";e.r(i),e.d(i,"default",(function(){return v}));var n=e(2),a=e(186),r=e(136),s=e(4),o=e(13),d=e(90),h=e(0);const c="yandexContextAsyncCallbacks";let l=!1,g=!1;function f(t){!function(t){if(!1===g&&!1===l){l=!0,window[c]=window[c]||[],window[c].push((function(){l=!1,g=!0,t&&t()}));var i=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.src="//an.yandex.ru/system/context.js",e.async=!0,i.parentNode.insertBefore(e,i)}else!0===g&&t&&t()}((function(){var i=Math.floor(4294967295*Math.random())+1;window.Ya.Context.AdvManager.render({blockId:t.block_id,renderTo:t.render_to,inpage:{slide:!0,visibleAfterInit:!1,adFoxUrl:t.adfox_url+i,insertAfter:"undefined",insertPosition:"0"}},(function(t){}))}))}var p=e(28),u=e(11);function m(t="Init error",i,e,...a){n["Init error"===t?"error":"log"]("propaganda",`Adfox banner #${i} "${e}" — ${t}`,...a)}class b extends p.b{constructor(t,i,e,n){super(),this.config=t,this.element=i,this.providerData=t[t.provider],this.bannerId=e,this.id="propaganda_"+Object(o.a)(),this.controlling_module=n,h.attr(this.element,"id",this.id)}init(){const t="UA"===h.attr(document.body,"data-country-code");this.providerData.containerId=this.id,t&&(this.providerData.customDomain="ads.adfox.me"),this.providerData.onLoad=t=>{},this.providerData.onRender=()=>{let t=h.find(this.element,'[src*="banners.adfox.ru/transparent.gif"]');this.trackBannerViaHawk("Banner rendered",{emptyBanner:t}),t?this.providerData.onStub():(h.addClass(this.element,"propaganda--shown"),this.controlling_module.trigger("Propaganda shown",{id:this.bannerId,container_id:this.id,element:this.element}),this.controlling_module.isAllowedAcceptable&&u.sendDefaultEvent(`Acceptable — ${this.config.label} (${this.config.id})`)),t=null},this.providerData.onStub=()=>{this.trackBannerViaHawk("Banner is empty"),h.addClass(this.element,"propaganda--empty"),this.controlling_module.triggerOnce("Propaganda empty",{id:this.bannerId,container_id:this.id,element:this.element,config:this.config})},this.providerData.onError=t=>{this.trackBannerViaHawk("Banner with error",t),h.addClass(this.element,"propaganda--error"),this.controlling_module.triggerOnce("Propaganda error",{id:this.bannerId,container_id:this.id,element:this.element}),m("Init error",this.bannerId,this.config.label,t)},this.moduleTargeting=Air.import("module.targeting");const i={};this.controlling_module.isAllowedAcceptable&&(i.puid6="1"),this.providerData.params=Object(d.a)({},this.providerData.params,this.moduleTargeting.get(),i),null==this.config.adfox_method&&(this.config.adfox_method="createScroll"),this.instance=window.Ya.adfoxCode[this.config.adfox_method](this.providerData,this.config.adaptive,{phoneWidth:839,isAutoReloads:!0}),this.trackBannerViaHawk("Banner created")}trackBannerViaHawk(t,i){if(22!==this.bannerId)return;const e=window.Air&&window.Air.get("module.hawk");e&&e.catch("Adfox 1x1 debug --\x3e "+t,i)}refresh(){this.destroyInstance(),this.init()}reload(){this.instance&&this.instance.reload()}destroy(){this.destroyInstance(),this.element=this.instance=this.providerData=this.config=null}destroyInstance(){if(this.instance)try{this.instance.destroy(),this.clear()}catch(t){m("Destroy error",this.bannerId,this.config.label,t)}}clear(){["empty","error","shown"].forEach(t=>{h.bem.toggle(this.element,t,!1)})}}class w{constructor(t,i,e){this.config=t,this.element=i,this.bannerId=e,this.providerData=t[t.provider],h.attr(this.element,"id",this.providerData.render_to)}init(){f({block_id:this.providerData.block_id,render_to:this.providerData.render_to,adfox_url:this.providerData.adfox_url})}destroy(){this.element=this.config=this.providerData=null}}class y{constructor({element:t,controlling_module:i}){this.element=t,this.bannerId=parseInt(h.attr(this.element,"data-id")),this.config=this.getConfig(i.config),this.controllingModule=i,this.init()}getConfig(t){return t.find(t=>t.id===this.bannerId)}init(){const t=!this.controllingModule.isAllowedAcceptable||!!this.config.acceptable;if(!this.config.disable&&t){switch(this.config.provider){case"adfox":this.instance=new b(this.config,this.element,this.bannerId,this.controllingModule);break;case"yandex":this.instance=new w(this.config,this.element,this.bannerId)}this.instance&&this.instance.init()}}refresh(){this.config.auto_reload&&!this.config.disable&&this.init()}reload(){this.config.disable||this.instance&&this.instance.reload()}destroy(){this.config.disable||(this.instance&&this.instance.destroy(),this.element=this.config=this.instance=null)}destroyInstance(){this.config.disable||(this.instance&&this.instance.destroy(),this.instance=null)}}class v{constructor({controllingModule:t}){this.fabric=null,this.controllingModule=t,this.moduleTargeting=Air.import("module.targeting"),this.moduleAjaxify=Air.import("module.ajaxify"),this.moduleAuthData=Air.import("module.auth_data"),this.adfoxLoading=void 0}init(){this.adfoxLoading||(this.adfoxLoading=Object(a.d)()),this.adfoxLoading.then(()=>{this.checkAnonBanners(),this.moduleTargeting.update(),this.fabric=new s.a({selector:".propaganda[data-id]",Constructor:y,controlling_module:this.controllingModule}),this.moduleAjaxify.on("Before page changed",()=>{this.destroy()})}).catch(t=>{n.warn("propaganda",t.message),Object(r.c)(!0)}),Object(a.e)()}addBanner({prependTo:t,id:i}){this.adfoxLoading||this.init(),this.adfoxLoading.then(()=>{const e=h.parseHTML(`<div class="propaganda" data-id="${parseInt(i,10)}"></div>`);h.prepend(t,e),this.fabric.add(e)})}refresh(){this.checkAnonBanners(),this.moduleTargeting.update(),this.fabric?this.fabric.update():this.init()}destroy(){this.fabric&&(this.fabric.each((t,i)=>{i&&i.destroyInstance&&i.destroyInstance(),i&&1===i.bannerId&&Object(a.b)()}),this.fabric.destroy())}checkAnonBanners(){this.moduleAuthData.isAuthorized()&&Object(a.c)()}}}}]);